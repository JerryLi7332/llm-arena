# 用户认证系统使用指南

## 概述

本项目已成功集成了完整的用户认证系统，包括用户注册、登录和仪表板功能。

## 功能特性

### 1. 用户注册
- **路径**: `/auth/register`
- **功能**: 新用户注册
- **验证规则**:
  - 用户名: 3-20位字母数字下划线
  - 邮箱: 有效的邮箱格式
  - 密码: 至少8位，包含字母和数字
  - 确认密码: 必须与密码一致

### 2. 用户登录
- **路径**: `/auth/login`
- **功能**: 用户登录认证
- **特性**:
  - 记住我功能
  - 自动保存用户名
  - 登录成功后自动跳转

### 3. 用户仪表板
- **路径**: `/dashboard`
- **功能**: 登录后的用户界面
- **特性**:
  - 显示用户信息
  - 统计信息展示
  - 功能模块导航

### 4. 管理后台
- **路径**: `/`
- **功能**: 原有的管理后台系统
- **访问**: 需要管理员权限

## API 端点

### 认证相关
- `POST /api/v1/base/auth/register` - 用户注册
- `POST /api/v1/base/auth/access_token` - 用户登录
- `POST /api/v1/base/refresh_token` - 刷新令牌
- `GET /api/v1/base/userinfo` - 获取用户信息

### 用户管理
- `GET /api/v1/users/list` - 获取用户列表
- `POST /api/v1/users/create` - 创建用户
- `POST /api/v1/users/update` - 更新用户
- `DELETE /api/v1/users/delete` - 删除用户

## 使用流程

### 1. 新用户注册
1. 访问 `/auth/register` 页面
2. 填写注册信息
3. 提交注册表单
4. 注册成功后自动跳转到登录页面

### 2. 用户登录
1. 访问 `/auth/login` 页面
2. 输入用户名和密码
3. 可选择"记住我"
4. 登录成功后跳转到仪表板

### 3. 访问管理后台
1. 使用管理员账号登录
2. 访问 `/` 进入管理后台
3. 进行系统管理操作

## 安全特性

### 1. 密码安全
- 密码强度验证
- 密码哈希存储
- 密码重置功能

### 2. 令牌管理
- JWT访问令牌
- 刷新令牌机制
- 令牌过期处理

### 3. 访问控制
- 基于角色的权限控制
- API访问限制
- 中间件审计日志

## 技术实现

### 后端技术栈
- **框架**: FastAPI
- **数据库**: Tortoise ORM
- **认证**: JWT
- **密码**: bcrypt
- **缓存**: Redis (可选)

### 前端技术栈
- **样式**: Bootstrap 5
- **交互**: 原生JavaScript
- **存储**: localStorage
- **路由**: 前端路由

## 部署说明

### 1. 环境要求
- Python 3.8+
- 数据库 (SQLite/MySQL/PostgreSQL)
- 可选: Redis缓存

### 2. 启动步骤
```bash
# 安装依赖
pip install -r requirements.txt

# 初始化数据库
aerich init-db

# 启动服务
python run.py
```

### 3. 访问地址
- 注册页面: `http://localhost:8000/register`
- 登录页面: `http://localhost:8000/login`
- 用户仪表板: `http://localhost:8000/dashboard`
- 管理后台: `http://localhost:8000/`
- API文档: `http://localhost:8000/docs`

## 注意事项

1. **首次使用**: 系统会自动创建超级管理员账号 (admin/abcd1234)
2. **权限控制**: 普通用户只能访问仪表板，管理员可以访问管理后台
3. **数据安全**: 所有密码都经过哈希处理，不会明文存储
4. **会话管理**: 支持令牌刷新，提供更好的用户体验

## 故障排除

### 常见问题

1. **注册失败**
   - 检查用户名是否已存在
   - 验证邮箱格式是否正确
   - 确认密码强度是否符合要求

2. **登录失败**
   - 检查用户名和密码是否正确
   - 确认用户账号是否被禁用
   - 查看网络连接是否正常

3. **页面访问被拒绝**
   - 确认是否已登录
   - 检查令牌是否有效
   - 验证用户权限是否足够

### 调试方法

1. **查看浏览器控制台**: 检查JavaScript错误
2. **查看服务器日志**: 检查后端错误信息
3. **使用API文档**: 测试API端点功能
4. **检查网络请求**: 确认API调用是否成功

## 扩展功能

### 可添加的功能
- 邮箱验证
- 手机号验证
- 第三方登录 (OAuth)
- 双因素认证
- 密码重置邮件
- 用户头像上传
- 用户偏好设置

### 自定义配置
- 修改密码策略
- 调整令牌过期时间
- 自定义用户角色
- 添加新的权限控制

---

如有问题，请查看项目文档或联系开发团队。 